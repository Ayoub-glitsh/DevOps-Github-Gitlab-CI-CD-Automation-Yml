name: üîÑ Sync to GitLab

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:  # Allows manual triggering

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Get all history
          
      - name: üîß Configure Git
        run: |
          git config user.name "GitHub Sync Bot"
          git config user.email "github-actions@github.com"
          
      - name: üöÄ Push to GitLab
        env:
          GITLAB_USER: "${{ secrets.GITLAB_USERNAME }}"
          GITLAB_TOKEN: "${{ secrets.GITLAB_TOKEN }}"
          GITLAB_PROJECT: "${{ github.event.repository.name }}"  # Uses current repo name
        run: |
          # Debug information
          echo "Syncing to GitLab..."
          echo "GitLab User: $GITLAB_USER"
          echo "GitLab Project: $GITLAB_PROJECT"
          
          # Check if repository exists on GitLab
          echo "Checking if repository exists on GitLab..."
          
          # Add GitLab as remote (using oauth2 format for GitLab)
          git remote add gitlab https://oauth2:${GITLAB_TOKEN}@gitlab.com/${GITLAB_USER}/${GITLAB_PROJECT}.git
          
          # Push to GitLab
          echo "Pushing code to GitLab..."
          git push gitlab HEAD:${GITHUB_REF#refs/heads/} --tags
          
          # Success message
          echo "‚úÖ Sync completed successfully!"
          echo "üìÅ GitLab Repository: https://gitlab.com/${GITLAB_USER}/${GITLAB_PROJECT}"
          
      - name: üìä Sync Status
        if: always()
        run: |
          if [ "${{ job.status }}" == "success" ]; then
            echo "üéâ Synchronization successful!"
          else
            echo "‚ö†Ô∏è Synchronization encountered issues"
            echo "Check the logs above for details"
          fi
